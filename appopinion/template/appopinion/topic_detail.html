{% extends 'appopinion/base.html' %}

{%  block content%}
<script>
  // callback function for like
  function likecallback(data){
    document.getElementById("likecount").innerHTML = data.likecount;
  }
  
  // callback function for vote
  function votecallback(data){
    if (data.change==0)
        return;

    oldcount = parseInt(document.getElementById("votecount" + data.commentid).innerHTML);
    document.getElementById("votecount" + data.commentid).innerHTML = oldcount + data.change;
  }
</script>


<div class="container">
	<div class="row">
		<div class="col-md-8 col-md-offset-2">
			<h1>{{topic.title}}</h1>
			<h3><small>{{topic.source}} - {{topic.date}}</small></h3>
		</div>
		<div class="col-md-8 col-md-offset-2">
			<p class="lead">{{topic.content}} <a class="btn btn-primary btn-sm" href="{{ topic.url }}" role="button">Source Link</a>
            </p>
            <p>
            <form action="{% url 'appopinion:like' topic.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary btn-sm">
                    Like&nbsp

<<<<<<< HEAD
		<form action="{% url 'appopinion:like' topic.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary btn-sm">
                Like&nbsp

              <span class="badge">{{topic.likecount}}</span></button>
            </div>
        </form>
=======
                  <span class="badge">{{topic.likecount}}</span></button>
            </form>
            </p>
            <!--
            <p>
            <button
                onclick="Dajaxice.appopinion.like(likecallback, {'topicid':{{topic_id}}});"
                class="btn btn-primary btn-sm"
                >
                Like&nbsp
              <span class="badge" id="likecount">{{topic.likecount}}</span>
            </button>
            </p>
            -->
        </div>
>>>>>>> ajax
  	</div>
  	<div class="row">
		<div class="col-md-8 col-md-offset-2">
		<form action="" method="post">
    		{% csrf_token %}
    		<input type="hidden" name="parent_id" value={{topic_id}}></input>
    		<div class="form-group">
    			<label for="content">New Comment</label>
    			<textarea class="form-control" name="content" id="content" placeholder="Comment" ROWS=3></textarea>
  			</div>
    		<button type="submit" class="btn btn-default" >Submit</button>
		</form>
		</div>
  	</div>
  	<div class="row">
  		
  		<div class="col-md-8 col-md-offset-2">
  		<h3>All comments</h3>
  		<ul class="list-group">
  			{% for comment in comment_list %}
  			<li class="list-group-item">
              <div>
                <p>{{comment.content}}</p>
                <p>
                  {% if user.is_authenticated %}
                    <span class="badge" id="votecount{{comment.id}}">{{comment.vote}}</span>
                    <a href='#' onclick="Dajaxice.appopinion.vote(votecallback, 
                        {'commentid':{{comment.id}}, 'up':1});">Up Vote</a>
                    <a href='#' onclick="Dajaxice.appopinion.vote(votecallback, 
                        {'commentid':{{comment.id}}, 'up':0});">Down vote</a>
                  {% else %}
                    Please sign in to vote.
                  {% endif %}
                </p>
              </div>
            </li>
  			{% endfor %}
		</ul>			
		</div>
	</div>
</div>
{% endblock %}
